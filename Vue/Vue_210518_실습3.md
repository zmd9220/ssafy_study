# Vue_210518_실습3



## 오전



- 전체 코드는 Homework n Workshop/code/workshop_06_07에 있음



### 워크샵 6

- 서버와 클라이언트 기본 세팅

```bash
# 서버
$ cd server
$ python -m venv venv
# select interpreter server/venv/Scripts/python.exe
$ pip install -r requirements.txt
$ python manage.py migrate
$ python manage.py runserver

# 클라이언트 배쉬 따로 열어서
$ cd client
$ npm install
$ npm run serve
```



#### 회원가입 기능이 구현 안되어있어서 이거 먼저 진행

##### 서버

- 시리얼라이저에 signup 모델 구축
- urls에 경로 설정
- views signup 함수 주석 해제

##### 클라이언트

- package.json, jsconfig.json가 있는데 못 찾는 다고 뜨는 이유 - client가 현재 루트 폴더 (최상위 폴더)가 아닌 상태로 vscode를 연 상태라 vetur가 못 찾는 상태
- 환경 변수(.env.local)에 VUE_APP_SERVER_URL 추가 - 환경 변수 설정 이후에는 서버를 재실행해야함
- signup.vue 부분 수정
- 여기까지 하면 cors 에러가 발생
- 서버측에서 cors로 현재 클라이언트 페이지 허용
- 중간에 뜨던 404 에러 원인을 몰랐는데 그냥 새로고침하니 해결 됨



#### Todo 구현 (생성, 삭제, 수정)

- TodoList.vue 수정 (created 추가, v-for 부분 pk로 수정)

- CreateTodo.vue 수정 (url을 환경 변수 기반으로 변경, axios 인덴트(문법) 깔끔하게 정리)

- url 부분은 환경 변수를 기반으로 해서 변경을 하도록 하는 것을 추천 (나중에 배포시에 일일히 수정하지 않아도 됨)

- TodoList.vue 추가 수정

  - deleteTodo 기능 수정 (서버와 연결 후 삭제, 응답 받으면 getTodos로 화면 갱신)
  - updateTodoStatus 수정 (데이터를 받아서 completed만 반대로 바꿔서 서버에 넘김, 갱신 후 getTodos로 갱신)

- promise로 요청하면 특정 결과 응답을 받았을 때 .then(콜백 함수)으로 꺼내서 사용했었음 -> 비동기 작업은 언제 대답이 올지 모름 그래서 .then으로 응답이 왔을 때 실행할 함수를 따로 지정해둠

- async await는 비동기적으로 동작하는 함수라고 미리 알림 (async) await 부분은 비동기로 들어올 응답에 대해서 변수로 받아서 밑에 사용하겠다. - 현업에선 이 방식이 간결해서 많이 사용되는 편

  

### 워크샵 7



- 서버에서 todos model - user:todo 간 1:N 관계 구성 `user = models.ForeignKey(settings.AUTH_USER_MODEL,  on_delete=models.CASCADE, related_name='todos')`

- 모델 재정의 후 makemigrations, migrate 진행



#### 로그인 기능

- 먼저 jwt 토큰 사용을 위해 drf-jwt 설치 `pip install djangorestframework-jwt`
- 이번 구현의 경우 모든 케이스가 로그인이 필요하므로 전체 페이지에 적용하려고 했는데 회원가입 부분이 막힐 수도 있었다. (이런 부분이 인증(로그인, 회원정보)서버와 api서버를 따로 두는 이유 중 하나)
  - 실제 전역으로 설정해놓고 회원가입을 하려고하니 401에러 (비인증)가 나오므로 전역으로 사용하기 어려울 듯 함..
- JWT_AUTH (속성 설정) - 발급 갱신 기간을 1일로 늘려놓음(연습용이라 길게)
- 토큰을 발급받을 수 있는 부분 설정

```python
from rest_framework_jwt.views import obtain_jwt_token
urlpatterns = [
    path('api-token-auth/', obtain_jwt_token),
]
```

- 이미 가지고 있는 토큰을 검증해보기
  - curl -X(메소드 타입), -H(헤더 타입), -d(데이터) - 커맨드로 보낼 때
  - 포스트맨으로 보내면 json에서 데이터를 넣어 보내면 됨
  - 응답이 200이면 검증 ok, 400이면 검증 x